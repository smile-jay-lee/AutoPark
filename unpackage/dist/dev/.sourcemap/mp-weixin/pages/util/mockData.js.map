{"version":3,"file":"mockData.js","sources":["pages/util/mockData.js"],"sourcesContent":["import { getStorage, setStorage, removeStorage } from '@/pages/common/storage'\r\n\r\nconst DEFAULT_PARKING_LOTS = [\r\n  {\r\n    id: 'lot-wenzhou-airport',\r\n    name: '温州机场宏韵停车场',\r\n    address: '浙江省温州市龙湾区海滨街道蟾钟村丰蓝路空港国际对面',\r\n    latitude: 27.915,\r\n    longitude: 120.845,\r\n    distance: 0,\r\n    availableQuota: 50,\r\n    totalCapacity: 100,\r\n    depositAmount: 6,\r\n    pricePerHour: 20,\r\n    allowedReservationDays: 30,\r\n    businessHours: '全天 24 小时开放',\r\n    description: '温州机场专用停车场，提供预约服务，停一天仅需20元'\r\n  },\r\n  {\r\n    id: 'lot-central-plaza',\r\n    name: '中心广场停车场',\r\n    address: '广州市天河区中心广场路 88 号',\r\n    latitude: 23.12911,\r\n    longitude: 113.264385,\r\n    distance: 0,\r\n    availableQuota: 18,\r\n    totalCapacity: 120,\r\n    depositAmount: 20,\r\n    pricePerHour: 6,\r\n    allowedReservationDays: 3,\r\n    businessHours: '全天 24 小时开放',\r\n    description: '临近商圈的地面停车场，支持扫码入场与车牌识别'\r\n  },\r\n  {\r\n    id: 'lot-metro-hub',\r\n    name: '地铁枢纽地下停车场',\r\n    address: '广州市越秀区枢纽大道 66 号',\r\n    latitude: 23.135308,\r\n    longitude: 113.270793,\r\n    distance: 0,\r\n    availableQuota: 9,\r\n    totalCapacity: 260,\r\n    depositAmount: 15,\r\n    pricePerHour: 5,\r\n    allowedReservationDays: 5,\r\n    businessHours: '06:00 - 23:00',\r\n    description: '毗邻地铁站的地下停车库，支持线上预约与快速入场'\r\n  },\r\n  {\r\n    id: 'lot-tech-park',\r\n    name: '科技园智慧停车场',\r\n    address: '广州市番禺区科技大道 18 号',\r\n    latitude: 23.069572,\r\n    longitude: 113.397146,\r\n    distance: 0,\r\n    availableQuota: 25,\r\n    totalCapacity: 200,\r\n    depositAmount: 10,\r\n    pricePerHour: 4,\r\n    allowedReservationDays: 7,\r\n    businessHours: '全天 24 小时开放',\r\n    description: '园区内专属停车场，配备新能源充电桩与导航指引'\r\n  }\r\n]\r\n\r\nconst DEFAULT_PAYMENT_RECORDS = [\r\n  {\r\n    id: 'PAY20230501001',\r\n    title: '中心广场停车场预约',\r\n    amount: '20.00',\r\n    paymentTime: '2023-05-01 09:15:30',\r\n    paymentMethod: '微信支付',\r\n    transactionId: 'wx202305010915301234567890',\r\n    status: 'success', // success: 支付成功, pending: 支付中, failed: 支付失败, refunded: 已退款\r\n    canRefund: true,\r\n    reservationId: 'RES20230501001',\r\n    createdAt: '2023-05-01T09:15:30.000Z'\r\n  },\r\n  {\r\n    id: 'PAY20230502001',\r\n    title: '地铁枢纽地下停车场预约',\r\n    amount: '15.00',\r\n    paymentTime: '2023-05-02 14:22:45',\r\n    paymentMethod: '支付宝',\r\n    transactionId: 'al202305020915301234567890',\r\n    status: 'success',\r\n    canRefund: false,\r\n    reservationId: 'RES20230502001',\r\n    createdAt: '2023-05-02T14:22:45.000Z'\r\n  },\r\n  {\r\n    id: 'PAY20230503001',\r\n    title: '科技园智慧停车场预约',\r\n    amount: '10.00',\r\n    paymentTime: '2023-05-03 18:45:12',\r\n    paymentMethod: '微信支付',\r\n    transactionId: 'wx202305030915301234567890',\r\n    status: 'refunded',\r\n    canRefund: false,\r\n    reservationId: 'RES20230503001',\r\n    createdAt: '2023-05-03T18:45:12.000Z'\r\n  }\r\n]\r\n\r\nconst STORAGE_KEYS = {\r\n  parkingLots: 'mock.parkingLots',\r\n  reservations: 'mock.reservations',\r\n  paymentRecords: 'mock.paymentRecords'\r\n}\r\n\r\nfunction cloneDeep(data) {\r\n  return JSON.parse(JSON.stringify(data))\r\n}\r\n\r\nfunction ensureParkingLotsInitialized() {\r\n  const stored = getStorage(STORAGE_KEYS.parkingLots)\r\n  if (stored && Array.isArray(stored) && stored.length) {\r\n    return stored\r\n  }\r\n  setStorage(STORAGE_KEYS.parkingLots, cloneDeep(DEFAULT_PARKING_LOTS))\r\n  return cloneDeep(DEFAULT_PARKING_LOTS)\r\n}\r\n\r\nfunction ensurePaymentRecordsInitialized() {\r\n  const stored = getStorage(STORAGE_KEYS.paymentRecords)\r\n  if (stored && Array.isArray(stored) && stored.length) {\r\n    return stored\r\n  }\r\n  setStorage(STORAGE_KEYS.paymentRecords, cloneDeep(DEFAULT_PAYMENT_RECORDS))\r\n  return cloneDeep(DEFAULT_PAYMENT_RECORDS)\r\n}\r\n\r\nexport function getParkingLots() {\r\n  return cloneDeep(ensureParkingLotsInitialized())\r\n}\r\n\r\nexport function getParkingLotById(lotId) {\r\n  const list = ensureParkingLotsInitialized()\r\n  return cloneDeep(list.find((item) => item.id === lotId) || null)\r\n}\r\n\r\nexport function updateParkingLots(nextList) {\r\n  setStorage(STORAGE_KEYS.parkingLots, cloneDeep(nextList))\r\n}\r\n\r\nexport function adjustParkingLotQuota(lotId, delta) {\r\n  const list = ensureParkingLotsInitialized().map((item) => {\r\n    if (item.id !== lotId) {\r\n      return item\r\n    }\r\n    const nextAvailable = Math.max(0, item.availableQuota + delta)\r\n    return { ...item, availableQuota: nextAvailable }\r\n  })\r\n  updateParkingLots(list)\r\n}\r\n\r\nfunction ensureReservationsInitialized() {\r\n  const stored = getStorage(STORAGE_KEYS.reservations, [])\r\n  if (Array.isArray(stored)) {\r\n    return stored\r\n  }\r\n  setStorage(STORAGE_KEYS.reservations, [])\r\n  return []\r\n}\r\n\r\nexport function getReservations() {\r\n  return cloneDeep(ensureReservationsInitialized())\r\n}\r\n\r\nexport function getReservationById(reservationId) {\r\n  const reservations = ensureReservationsInitialized()\r\n  return cloneDeep(reservations.find((item) => item.id === reservationId) || null)\r\n}\r\n\r\nexport function saveReservation(reservation) {\r\n  const reservations = ensureReservationsInitialized()\r\n  const nextReservations = [cloneDeep(reservation), ...reservations]\r\n  setStorage(STORAGE_KEYS.reservations, nextReservations)\r\n}\r\n\r\nexport function generateReservationId() {\r\n  return `RES${Date.now()}${Math.floor(Math.random() * 1000).toString().padStart(3, '0')}`\r\n}\r\n\r\nexport function createReservation(reservationData) {\r\n  const reservation = {\r\n    id: generateReservationId(),\r\n    lotId: reservationData.lotId,\r\n    lotName: reservationData.lotName,\r\n    reservationDate: reservationData.reservationDate,\r\n    startDate: reservationData.startDate,\r\n    endDate: reservationData.endDate,\r\n    reservationDays: reservationData.reservationDays || 1,\r\n    arrivalTime: reservationData.arrivalTime,\r\n    durationHours: reservationData.durationHours,\r\n    plateNumber: reservationData.plateNumber,\r\n    phoneNumber: reservationData.phoneNumber,\r\n    depositAmount: reservationData.depositAmount,\r\n    couponAmount: reservationData.couponAmount || 0,\r\n    status: 'pending', // pending: 待入场, active: 使用中, completed: 已完成, cancelled: 已取消\r\n    createdAt: new Date().toISOString()\r\n  }\r\n  \r\n  saveReservation(reservation)\r\n  return reservation\r\n}\r\n\r\nexport function updateReservationStatus(reservationId, nextStatus, updater = (data) => data) {\r\n  const reservations = ensureReservationsInitialized()\r\n  const nextReservations = reservations.map((item) => {\r\n    if (item.id !== reservationId) {\r\n      return item\r\n    }\r\n    const nextReservation = { ...item, status: nextStatus }\r\n    return updater(nextReservation)\r\n  })\r\n  setStorage(STORAGE_KEYS.reservations, nextReservations)\r\n  return cloneDeep(nextReservations.find((item) => item.id === reservationId) || null)\r\n}\r\n\r\nexport function removeReservation(reservationId) {\r\n  const reservations = ensureReservationsInitialized()\r\n  const nextReservations = reservations.filter((item) => item.id !== reservationId)\r\n  setStorage(STORAGE_KEYS.reservations, nextReservations)\r\n  return nextReservations\r\n}\r\n\r\n// 支付记录相关方法\r\nexport function getPaymentRecords() {\r\n  return cloneDeep(ensurePaymentRecordsInitialized())\r\n}\r\n\r\n// 计算停车费优惠\r\nexport function calculateParkingFeeDiscount(amount) {\r\n  // 停车费用满160元优惠5元，满200元优惠10元\r\n  if (amount >= 200) {\r\n    return 10\r\n  } else if (amount >= 160) {\r\n    return 5\r\n  }\r\n  return 0\r\n}\r\n\r\n// 计算实际需要支付的停车费\r\nexport function calculateActualParkingFee(baseAmount) {\r\n  const discount = calculateParkingFeeDiscount(baseAmount)\r\n  return Math.max(0, baseAmount - discount)\r\n}\r\n\r\nexport function getPaymentRecordById(paymentId) {\r\n  const records = ensurePaymentRecordsInitialized()\r\n  return cloneDeep(records.find((item) => item.id === paymentId) || null)\r\n}\r\n\r\nexport function createPaymentRecord(paymentData) {\r\n  const payment = {\r\n    id: `PAY${Date.now()}${Math.floor(Math.random() * 1000).toString().padStart(3, '0')}`,\r\n    title: paymentData.title,\r\n    amount: paymentData.amount,\r\n    paymentTime: new Date().toLocaleString(),\r\n    paymentMethod: paymentData.paymentMethod || '微信支付',\r\n    transactionId: `tx${Date.now()}${Math.floor(Math.random() * 1000).toString().padStart(3, '0')}`,\r\n    status: 'success',\r\n    canRefund: paymentData.canRefund !== false,\r\n    reservationId: paymentData.reservationId,\r\n    createdAt: new Date().toISOString()\r\n  }\r\n  \r\n  const records = ensurePaymentRecordsInitialized()\r\n  const nextRecords = [cloneDeep(payment), ...records]\r\n  setStorage(STORAGE_KEYS.paymentRecords, nextRecords)\r\n  \r\n  return payment\r\n}\r\n\r\nexport function requestRefund(paymentId) {\r\n  const records = ensurePaymentRecordsInitialized()\r\n  const paymentRecord = records.find((item) => item.id === paymentId)\r\n  \r\n  if (!paymentRecord || paymentRecord.status !== 'success' || !paymentRecord.canRefund) {\r\n    return false\r\n  }\r\n  \r\n  const nextRecords = records.map((item) => {\r\n    if (item.id !== paymentId) {\r\n      return item\r\n    }\r\n    return { ...item, status: 'refunded', canRefund: false }\r\n  })\r\n  \r\n  setStorage(STORAGE_KEYS.paymentRecords, nextRecords)\r\n  return true\r\n}\r\n\r\nexport function createParkingLot(lotData) {\r\n  const list = ensureParkingLotsInitialized()\r\n  const newLot = {\r\n    id: `lot-${Date.now()}${Math.floor(Math.random() * 1000).toString().padStart(3, '0')}`,\r\n    name: lotData.name,\r\n    address: lotData.address,\r\n    latitude: lotData.latitude || 23.12911,\r\n    longitude: lotData.longitude || 113.264385,\r\n    distance: 0,\r\n    availableQuota: lotData.availableQuota || 0,\r\n    totalCapacity: lotData.totalCapacity || 0,\r\n    depositAmount: lotData.depositAmount || 0,\r\n    pricePerHour: lotData.pricePerHour || 0,\r\n    allowedReservationDays: lotData.allowedReservationDays || 7,\r\n    businessHours: lotData.businessHours || '全天 24 小时开放',\r\n    description: lotData.description || '',\r\n    status: lotData.status || 'active'\r\n  }\r\n  const nextList = [newLot, ...list]\r\n  updateParkingLots(nextList)\r\n  return newLot\r\n}\r\n\r\nexport function deleteParkingLot(lotId) {\r\n  const list = ensureParkingLotsInitialized()\r\n  const nextList = list.filter(item => item.id !== lotId)\r\n  updateParkingLots(nextList)\r\n  return nextList.length < list.length\r\n}\r\n\r\nexport function resetMockData() {\r\n  removeStorage(STORAGE_KEYS.parkingLots)\r\n  removeStorage(STORAGE_KEYS.reservations)\r\n  removeStorage(STORAGE_KEYS.paymentRecords)\r\n}\r\n\r\n/**\r\n * 发起退款申请\r\n * @param {string} paymentId - 支付记录ID\r\n * @returns {Object|null} 退款申请结果\r\n */\r\nexport function initiateRefund(paymentId) {\r\n  const records = getPaymentRecords()\r\n  const payment = records.find(p => p.id === paymentId)\r\n  \r\n  if (!payment || payment.status !== 'success' || !payment.canRefund) {\r\n    return null\r\n  }\r\n  \r\n  const nextRecords = records.map((item) => {\r\n    if (item.id !== paymentId) {\r\n      return item\r\n    }\r\n    return {\r\n      ...item,\r\n      status: 'refunding',\r\n      refundStatus: 'pending',\r\n      refundInitiatedAt: new Date().toISOString()\r\n    }\r\n  })\r\n  \r\n  setStorage(STORAGE_KEYS.paymentRecords, nextRecords)\r\n  return nextRecords.find(p => p.id === paymentId)\r\n}\r\n\r\n/**\r\n * 处理退款（管理员操作）\r\n * @param {string} refundId - 退款记录ID\r\n * @returns {Object|null} 处理结果\r\n */\r\nexport function processRefund(refundId) {\r\n  const records = getPaymentRecords()\r\n  const payment = records.find(p => p.id === refundId)\r\n  \r\n  if (!payment || payment.status !== 'refunding') {\r\n    return null\r\n  }\r\n  \r\n  const nextRecords = records.map((item) => {\r\n    if (item.id !== refundId) {\r\n      return item\r\n    }\r\n    return {\r\n      ...item,\r\n      status: 'refunded',\r\n      refundStatus: 'completed',\r\n      canRefund: false,\r\n      refundCompletedAt: new Date().toISOString()\r\n    }\r\n  })\r\n  \r\n  setStorage(STORAGE_KEYS.paymentRecords, nextRecords)\r\n  return nextRecords.find(p => p.id === refundId)\r\n}\r\n"],"names":["getStorage","setStorage"],"mappings":"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"}